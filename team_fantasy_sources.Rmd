---
title: "Team Score Scores - AFL Fantasy"
output: html_document
---

Assess team game styles with stoppage and transition splits below using the 2023 H&A season data.

* **Stoppages** - Total stoppage points from centre bounce (**CB**), ball-ups (**BU**), and throw-ins (**TI**)
* **Transition** - Total transition points from opposition turnover (**TO**) and kick-in/kick-in-receives (**KI**)

*Note AF totals are slightly off due to late scores adjustments (not reflected in stoppage data)*

```{r, echo=F, message = F, warning=F}
library(dplyr)
library(tibble)
library(reactable)
library(htmltools)

table <- readRDS("C:/Users/jpopo/Documents/Rstats/Breakdowns.rds") 

ptsfor <- table %>% 
  filter(season == 2023,Round<=24) %>% 
  group_by(Team) %>% 
  summarise(
    across(`Fantasy`:`Throw In`, ~ sum(.x,na.rm=T)/23),
    .groups = 'drop'
  ) %>% 
  left_join(httr::content(httr::GET('https://fantasy.afl.com.au/data/afl/squads.json'),as = "text",encoding = 'UTF-8') %>% jsonlite::fromJSON(flatten = TRUE), by = join_by(Team == full_name)) %>%
  select(Team=short_name,Fantasy,Stoppages,CB = `Centre Bounce`, BU = `Ball Up`,TI = `Throw In`,Transition,`TO` = Turnover, `KI` = KickIn) %>% 
  add_row(Team = "All", !!! colMeans(.[-1]))

ptsagn <- table %>% 
  filter(season == 2023,Round<=24) %>% 
  group_by(Opponent) %>% 
  summarise(
    across(`Fantasy`:`Throw In`, ~ sum(.x,na.rm=T)/23),
    .groups = 'drop'
  ) %>% 
  left_join(httr::content(httr::GET('https://fantasy.afl.com.au/data/afl/squads.json'),as = "text",encoding = 'UTF-8') %>% jsonlite::fromJSON(flatten = TRUE), by = join_by(Opponent == full_name)) %>%
  select(Team=short_name,Fantasy,Stoppages,CB = `Centre Bounce`, BU = `Ball Up`,TI = `Throw In`,Transition,`TO` = Turnover, `KI` = KickIn) %>% 
  add_row(Team = "All", !!! colMeans(.[-1]))

tableOutput <- function(data) {
  reactable(
  data = data,
  defaultSorted = c("Fantasy"),
  defaultSortOrder = "desc",
  showSortIcon = FALSE,
  showPageSizeOptions = F,
  striped = TRUE,
  defaultPageSize = 19,
  rowClass = function(index) {
    if (data[index,"Team"] == "All") {
      "boldedrow"
    }
  },
  #elementId = "fantasy-score-sources-table",
  style = list(
    fontSize = '12px'
  ),
  defaultColDef = colDef(
    format = colFormat(digits = 1),
    minWidth = 55
  ),
  searchable = T,
  columns = list(
    Team = colDef(
      minWidth = 55,
      defaultSortOrder = "asc",
      style = NULL,
      sticky = "left",
    ),
    Stoppages = colDef(
      sticky = "left",
      minWidth = 60
    ),
    Transition = colDef(
      sticky = "left",
      minWidth = 60
    ),
    Fantasy = colDef(
      name = "AF",
      minWidth = 55
    )
  )
)
}

h2("Points For")
tableOutput(ptsfor)

h2("Points Against")
tableOutput(ptsagn)

```